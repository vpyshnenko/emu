Emu Project Context (Condensed Continuation Prompt)

I am developing Emu, a deterministic execution engine for statically wired networks of communicating Reactive State Machines.

# EMU FORMAL SPECIFICATION â€” CONDENSED CONTEXT SUMMARY

## MODEL IDENTITY

Emu is formalized as a:

    Deterministic Network of Reactive State Machines

It is:

- Deterministic
- Untimed
- Asynchronous (in the sense of partial state updates)
- Message-driven
- Small-step operational
- Interleaving semantics
- Causally traceable

It belongs to:

- Communicating automata
- Reactive transition systems

with deterministic subscriber ordering and a single global pending frontier.

---

## ONTOLOGY

Primitive domains:

- NodeId
- InPortId
- OutPortId
- Value
- State

Core entities:

- Node (reactive state machine)
- Input Port
- Output Port
- Emitted Value: (src, op, v)
- Delivered Event: (dst, ip, v)
- Network (nodes + routing relation)
- Global State: Ïƒ : NodeId â†’ State
- Snapshot (Approach 1):
      Snapshot = (Ïƒ, E)
  where E is an ordered list of Emitted Values

---

## STATIC STRUCTURE

For each node n:

    Î´â‚™ : State Ã— InPortId Ã— Value
          â†’ State Ã— List(OutPortId Ã— Value)

Connectivity:

    R âŠ† (NodeId Ã— OutPortId)
          Ã—
         (NodeId Ã— InPortId)

Subscriber order:

    Subs(src, op) = ordered list derived from R

---

## TWO EMISSIONâ€“DELIVERY SEMANTICS

### Approach 1 â€” Late Routing (CANONICAL)

Queue contains:

    (src, op, v)

On dequeue:

- Expand subscribers
- Deliver sequentially
- Each subscriber â†’ one atomic snapshot
- Emissions appended as (dst, op_i, v_i)

Properties:

- Rich causality grouping
- Natural fan-out blocks
- Smaller queue
- No stale deliveries
- Dynamic routing compatible
- Hot observable semantics

This is the canonical Emu semantics.

---

### Approach 2 â€” Early Routing (Derived / Testing Mode)

Queue contains:

    (dst, ip, v)

Routing expanded at enqueue time.

Pros:

- Simpler dequeue
- One dequeue = one snapshot
- Good for isolated node testing

Cons:

- Loses native causality grouping
- Needs provenance metadata for trace reconstruction
- Emissions vanish without subscribers unless special handling added
- Routing decisions frozen at enqueue time

Conclusion:

Approach 1 retained as canonical semantics.

---

## DYNAMICS (APPROACH 1 SUMMARY)

Snapshot:

    (Ïƒ, (src, op, v) :: E_rest)

For each subscriber in order:

    (dst, ip)

Compute:

    (s', outs) = Î´_dst(Ïƒ(dst), ip, v)

Update:

    Ïƒ' = Ïƒ[dst â†¦ s']

Append:

    [(dst, op_i, v_i)]

Reaction to one emission produces a sequence of atomic steps
(interleaving semantics).

---

## EXTERNAL INTERACTION

External world may:

- Inject emitted values (src, op, v)
- Observe emitted values

External world does NOT:

- Directly modify state
- Inject delivered events

---

## CONCURRENCY MODEL

Emu:

- Is untimed
- Is asynchronous (partial state updates)
- Admits interleaving semantics
- Uses deterministic scheduling
- Has causally ordered execution

---

## KEY CONCEPTUAL INSIGHT

Approach 1 models output ports as:

    Hot event sources (FRP analogy without time)

Emissions exist independently of subscription.

---

## CONTINUATION INSTRUCTION

Continue working on the formal specification of the
Deterministic Network of Reactive State Machines,
using Approach 1 (Late Routing Semantics) as canonical.

Maintain clean separation between:

- Ontology
- Static structure
- Dynamics
- External interaction
- Observables
- Failure behavior

Avoid mixing implementation details.


ðŸ”¹ Instruction to Assistant in New Conversation

Continue helping with technical documentation and architectural reasoning for Emu.
Be precise.
Avoid unnecessary poetics.
Keep terminology consistent.
Assume deterministic, time-free, FIFO event model as described above.